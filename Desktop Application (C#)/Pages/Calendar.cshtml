@page
@model Wilgproject.Pages.CalendarModel

@{
    ViewData["Title"] = "Calendar";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            margin: 20px;
            font-family: Arial, sans-serif;
            background: #f8f9fa;
        }

        #calendar {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
        }

        .modal-header {
            color: white;
        }

        .add-header {
            background-color: #198754; /* green */
        }

        .edit-header {
            background-color: #0d6efd; /* blue */
        }

        .delete-header {
            background-color: #dc3545; /* red */
        }
    </style>
</head>
<body>
    <h2 class="text-center mb-4">📅 Advanced Calendar</h2>
    <div id="calendar"></div>

    <!-- Add Event Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-3 shadow">
                <div class="modal-header add-header">
                    <h5 class="modal-title">Add New Event</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="eventTitle" class="form-control" placeholder="Enter event title..." />
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-success" id="saveEventBtn">Add Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-3 shadow">
                <div class="modal-header edit-header">
                    <h5 class="modal-title">Edit Event</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="editEventTitle" class="form-control" />
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-danger" id="deleteFromEditBtn">Delete</button>
                    <button class="btn btn-primary" id="updateEventBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-3 shadow">
                <div class="modal-header delete-header">
                    <h5 class="modal-title">Delete Event</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this event?
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var selectedInfo = null;
            var selectedEvent = null;

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                initialDate: '2025-08-01',
                selectable: true,
                editable: true,
                events: [
                    { title: 'Event 1', start: '2025-08-01' },
                    { title: 'Event 2', start: '2025-08-05', end: '2025-08-07' }
                ],
                select: function (info) {
                    selectedInfo = info;
                    var myModal = new bootstrap.Modal(document.getElementById('eventModal'));
                    myModal.show();
                },
                eventClick: function (info) {
                    selectedEvent = info.event;
                    document.getElementById("editEventTitle").value = selectedEvent.title;
                    var editModal = new bootstrap.Modal(document.getElementById('editModal'));
                    editModal.show();
                }
            });
            calendar.render();

            // Save Event
            document.getElementById("saveEventBtn").addEventListener("click", function () {
                var title = document.getElementById("eventTitle").value;
                if (title && selectedInfo) {
                    calendar.addEvent({
                        title: title,
                        start: selectedInfo.start,
                        end: selectedInfo.end,
                        allDay: selectedInfo.allDay
                    });
                }
                document.getElementById("eventTitle").value = "";
                selectedInfo = null;
                var modal = bootstrap.Modal.getInstance(document.getElementById('eventModal'));
                modal.hide();
            });

            // Update Event
            document.getElementById("updateEventBtn").addEventListener("click", function () {
                var newTitle = document.getElementById("editEventTitle").value;
                if (selectedEvent && newTitle) {
                    selectedEvent.setProp("title", newTitle);
                }
                selectedEvent = null;
                var modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                modal.hide();
            });

            // Delete from Edit Modal → open delete confirmation
            document.getElementById("deleteFromEditBtn").addEventListener("click", function () {
                var editModal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                editModal.hide();
                var deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
                deleteModal.show();
            });

            // Confirm Delete
            document.getElementById("confirmDeleteBtn").addEventListener("click", function () {
                if (selectedEvent) {
                    selectedEvent.remove();
                    selectedEvent = null;
                }
                var modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                modal.hide();
            });
        });
    </script>
</body>
</html>